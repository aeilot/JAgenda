<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日程优化 - JAgenda</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/modern-apple.css' %}">
</head>

<body>
    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: var(--space-4);">
        <div class="modern-container">
            <h1 class="modern-title">JAgenda</h1>
            <h2 class="modern-section-title" style="text-align: center; margin-bottom: var(--space-8);">日程优化</h2>
            
            <form method="POST" enctype="multipart/form-data" id="agendaForm" action="/agenda/">
                {% csrf_token %}
                
                <div style="margin-bottom: var(--space-6);">
                    <label for="user_input" class="modern-label">输入你的日程</label>
                    <textarea 
                        id="user_input" 
                        name="user_input"
                        class="modern-textarea"
                        placeholder="请输入您的日程安排..."
                        style="margin-bottom: var(--space-4);"
                    >{{user_input}}</textarea>
                    <div class="modern-example">示例: 10:00 线性代数 | 12:00 数学分析</div>
                </div>

                <div class="modern-file-input">
                    <input type="file" id="pdf_file" name="pdf_file" accept="application/pdf" />
                    <label for="pdf_file" class="modern-file-label">
                        📄 或上传 PDF 日程表
                        <div style="font-size: var(--font-size-xs); margin-top: var(--space-1); opacity: 0.7;">
                            支持 PDF 格式文件
                        </div>
                    </label>
                </div>

                <div class="modern-btn-group">
                    <button type="submit" class="modern-btn modern-btn-primary" id="submitBtn">
                        ✨ 获取个性化建议
                    </button>
                    <a href="/" class="modern-btn modern-btn-secondary">← 返回首页</a>
                </div>
            </form>

            {% if output %}
            <div class="modern-output">
                <h3>🎯 个性化建议结果</h3>
                {% autoescape off %}
                {{response_text}}
                {% endautoescape %}
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        const form = document.getElementById('agendaForm');
        const submitBtn = document.getElementById('submitBtn');
        const scheduleInput = document.getElementById('user_input');
        const fileInput = document.getElementById('pdf_file');
        const fileLabel = document.querySelector('.modern-file-label');

        // Add loading state to form submission
        form.addEventListener('submit', function (e) {
            const hasInput = scheduleInput.value.trim() || fileInput.files.length > 0;
            
            if (!hasInput) {
                e.preventDefault();
                alert('请输入日程内容或上传PDF文件');
                return;
            }

            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '✨ 正在生成建议...';
            submitBtn.disabled = true;
        });

        // Update file input label
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                fileLabel.innerHTML = `📄 已选择: ${this.files[0].name}`;
                fileLabel.style.borderColor = 'var(--primary-blue)';
                fileLabel.style.background = 'var(--primary-blue-light)';
                fileLabel.style.color = 'var(--primary-blue)';
            } else {
                fileLabel.innerHTML = '📄 或上传 PDF 日程表<div style="font-size: var(--font-size-xs); margin-top: var(--space-1); opacity: 0.7;">支持 PDF 格式文件</div>';
                fileLabel.style.borderColor = 'var(--neutral-300)';
                fileLabel.style.background = 'var(--neutral-50)';
                fileLabel.style.color = 'var(--neutral-600)';
            }
        });
    </script>
</body>

</html>